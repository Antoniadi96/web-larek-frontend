# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

- Товар 

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

- Заказ

```
interface IOrder {
  items: string[]; 
  total: number;
  payment: string;        
  address: string;        
  email: string;
  phone: string;
}
```

- Интерфейс для модели данных продуктов

```
interface IProductsData {
  products: IProduct[];
  preview: string | null;
  setProducts(products: IProduct[]): void;
  getProducts(): IProduct[];
  getProduct(id: string): IProduct;
  saveProduct(product: IProduct): void;
  savePreview(id: string | null): void;
}
```

## Архитектура приложения

Приложение построено по архитектуре MVP, где код разбит на три основных компонента:

- Представление (View) - отвечает за визуализацию данных
- Модель данных (Model) - занимается хранением и обработкой информации
- Презентер (Presenter) - служит связующим звеном между представлением и данными

### Базовый код

#### Класс Api

Это базовый инструмент для работы с сетевыми запросами. При создании объекта класса необходимо указать адрес сервера, а также можно добавить дополнительные заголовки запросов.
Класс предоставляет два основных метода:

- `get()` - делает GET-запрос к указанному эндпоинту и возвращает промис с ответом сервера
- `post()` - отправляет POST-запрос с JSON-данными в теле. Поддерживает возможность изменения метода запроса через дополнительный параметр

#### Класс EventEmitter

Представляет собой систему событийного брокера. Используется для организации коммуникации между компонентами приложения, особенно между презентером и другими слоями системы.
Интерфейс `IEvents` определяет ключевые методы:

`on()` - подписывается на событие
`off()` - отписывается от события
`emit()` - запускает событие

#### Класс Component

Служит базовым классом для всех элементов интерфейса. Это абстрактный класс предоставляющий набор инструментов для работы с DOM-элементами:
- управление CSS-классами
- изменение текстового содержимого
- обновление изображений
- контроль видимости элемента
- прочие базовые операции с DOM

### Слой данных

#### Класс ProductsData

Этот компонент служит для управления информацией о товарах. При создании объекта класса ему передается система событий. Внутри класса хранятся:

- \_products: IProduct[] - Массив карточек товаров
- \_preview: string | null - id выбранного товара
- events: IEvents - Система для отслеживания изменений в данных.

Так же класс имеет набор методов для взаимодействия с этими данными:

- setProducts(products: IProduct[]): void - Метод для заполнения массива карточек продуктов
- getProducts(): IProduct[] - Возвращает массив карточек продуктов
- getProduct(id: string): IProduct - Возвращает одну карточку продуктов по его id
- saveProduct(product: IProduct): void - Метод для сохранения карточки продукта
- savePreview(product: IProduct): void - Метод для сохранения Preview

#### Класс BasketData

Отвечает за обработку данных корзины покупок.
При инициализации получает систему событий. В полях класса хранятся следующие данные:

- \_basket: IProduct[] - Массив объектов продуктов, добавленных в корзину.
- events: IEvents - Механизм для отслеживания изменений состояния корзины.

  Класс предоставляет набор методов для взаимодействия с данными корзины:

- addToBasket(product: IProduct): void - Метод для добавления товара в корзину. 
- deleteFromBasket(product: IProduct): void - Метод для удаления товара из корзины.
- clearBasket(): void - Метод для очистки всей корзины.

#### Класс OrderData

Содержит данные о заказе и связанные с ними ошибки. Конструктор класса включает в себя:

- \_formErrors: FormErrors - Объект содержащий ошибки валидации форм
- events: IEvents — Механизм для отслеживания изменений в данных заказа и ошибках.
- \_order: IOrder — Объект, представляющий данные текущего заказа.

  Класс предоставляет набор методов для взаимодействия с данными заказа:

- setOrderField(field: keyof TOrderInput, value: string): void -Обновляет любое поле заказа на основе его имени и значения, после чего инициирует валидацию.
-  createOrder(items: TProductBasket[], total: number) - формирует объект для отправки на севрер

- validatePaymentForm(): boolean - Проверяет корректность заполнения заказа. Анализирует обязательные поля (address, payment) и при отсутствии данных в любом из них добавляет соответствующее сообщение об ошибке.
- validateContactsForm(): boolean - Проверяет корректность заполнения заказа. Анализирует обязательные поля (phone, email) и при отсутствии данных в любом из них добавляет соответствующее сообщение об ошибке.


### Классы представления

Представление управляет отображением данных и обработкой событий пользовательского интерфейса, таких как клики на карточки продуктов и кнопки.

#### Класс Modal

Класс Modal относится к слою представления (View) приложения. Показывает модальное окно пользователю/покупателю.
Предоставляет методы `open`, `close`, `render` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку крестик для закрытия модального окна.
Конструктор принимает два аргумента:

- container - корневой элемент модального окна в DOM, переданный в качестве `HTMLElement`.
- events - объект, реализующий интерфейс `IEvents`
  Поля класса:
- \_modalButtonClose: HTMLButtonElement - кнопка для закрытия модального окна
- \_modalContent - контейнер для содержимого модального окна
- events - брокер событий
  Методы класса:
- open() - открывает модальное окно, добавляет оверлей и устанавливает слушатели событий.
- close() - закрывает модальное окно, удаляет оверлей и убирает слушатели событий.
- render(content: HTMLElement) - загружает указанное содержимое в контейнер модального окна.

#### Класс PreviewCard

Класс PreviewCard отвечает за отображение превью карточки товара.
Содержит методы для, отображения информации о товаре, обработки кликов по карточке, добавления в корзину.
Конструктор принимает три аргумента:

- cardElement: HTMLElement - HTML элемент карточки
- productData: IProduct - данные о товаре
- events - объект, реализующий интерфейс `IEvents`
  Поля класса:
- _title: HTMLHeadingElement - заголовок карточки
- _image: HTMLImageElement - изображение товара
- _price: HTMLElement - цена товара
- _addToCartButton: HTMLButtonElement - кнопка добавления в корзину

#### Класс Header

Класс Header управляет отображением и функциональностью шапки сайта.
Содержит кнопку открытия корзины и счетчик товаров.
Конструктор принимает два аргумента:

- headerElement: HTMLElement - корневой элемент хедера
- events - объект, реализующий интерфейс `IEvents`

  Поля класса:
- _cartButton: HTMLButtonElement - кнопка открытия корзины
- _cartCounter: HTMLElement - элемент с количеством товаров
- _events: IEvents - ссылка на объект событий
- _onOpenCart: () => void - колбэк для открытия корзины

  Методы:
- updateCounter() - обновляет количество товаров в корзине
- openCart() - эмитит событие открытия корзины
- closeCart() - эмитит событие закрытия корзины

#### Класс Card

Класс Card так же относится к слою представления (View) приложения.
Он отвечает за отображение карточки продукта, задавая в карточке данные категории, заголовка, изображения, цены и описания. Класс наследуется от родительского класса `Component` и используется для отображения карточек на странице сайта.

Поля класса:

- _element: HTMLElement - корневой HTML-элемент карточки
- _onCardClick: () => void - колбэк для обработки клика по карточке
- _events: IEvents - ссылка на объект событий

Методы:

- render(cardData: ICard) - отображает данные карточки продукта
- remove() - удаляет карточку из DOM
- getElement() - возвращает корневой элемент карточки

#### Класс BasketCard

Класс BasketCard так же относится к слою представления (View) приложения.
Отвечает за отображение и управление карточками товаров, добавленных и удаление товаров в корзине.

При создании экземпляра класса передаются:
- element: HTMLElement - корневой элемент для рендеринга
- callbacks: {onRemove: (id: string) => void} - колбэк для удаления товара

Поля класса
- element: HTMLElement - HTML-элемент карточки
- eventEmitter: EventEmitter - для управления событиями
- callbacks: {onRemove: (id: string) => void} - сохраненный колбэк

Методы
render(product: Product) - метод для отрисовки карточки товара
handleRemove() - обрабатывает удаление товара из корзины



#### Класс Basket

Класс Basket так же относится к слою представления (View) приложения.
Класс Basket отвечает за управление корзиной товаров на странице. Он включает в себя отображение списка товаров, расчет общей стоимости и обработку пользовательских действий, таких как оформление заказа.

При инициализации получает следующие параметры:

- rootElement: HTMLElement - корневой элемент для отображения корзины
- basketData: BasketData - экземпляр класса с данными корзины

В полях класса хранятся:

- rootElement: HTMLElement - основной HTML-элемент корзины
- basketData: BasketData - ссылка на объект данных корзины
- totalPrice: number - общая стоимость товаров
- itemsContainer: HTMLElement - контейнер для карточек товаров

Методы:

- set items(items: HTMLElement[]) — сеттер для обновления списка товаров в корзине.

#### Класс OrderPayment

Класс OrderPayment так же относится к слою представления (View) приложения.
Отвечает за управление выбором способа оплаты и адресом доставки в форме заказа. 

Поля класса:

- \_buttonOnline: HTMLButtonElement — кнопка для выбора оплаты онлайн (картой)
- \_buttonCash: HTMLButtonElement — кнопка для выбора оплаты при получении
- \_address: HTMLInputElement — поле для ввода адреса доставки.

  Методы:

- set address(value: string) — сеттер для поля адреса, который устанавливающий адрес доставки.
- togglePayment(value: HTMLElement) — метод для переключения активного способа оплаты. Он сбрасывает предыдущий выбор и активирует выбранную кнопку.
- resetPayment() — метод для сброса состояния кнопок оплаты, используется при переключении кнопок.

#### Класс OrderContacts

Класс OrderContacts так же относится к слою представления (View) приложения.
Отвечает за управление контактной информацией (электронная почта и телефон) в форме заказа.
Поля класса:

- \_email: HTMLInputElement — поле ввода для электронной почты.
- \_phone: HTMLInputElement — поле ввода для номера телефона.

  Методы:

- set email(value: string) — сеттер для поля электронной почты. 
- set phone(value: string) — сеттер для поля номера телефона. 


#### Класс Catalog

Класс Catalog так же относится к слою представления (View) приложения.
Он отвечает за отображение каталога с карточками продукта на главной странице. Метод
`addCards(cardElement: HTMLElement)` для добавления всех карточек продукта на главную страницу сайта

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

  Поля класса:

- _api: Api — экземпляр базового класса API для выполнения HTTP-запросов.

  Методы:

- getProducts() — получение списка всех продуктов.
- getProduct(id: string) — получение одного продукта по ID.
- createOrder(order: IOrder) — создание нового заказа на сервере.

## Взаимодействие компонентов

Код, описывающий взаимодействие слоя представления и слоя данных между собой и фактически выполняющий роль презентера, находится в файле `index.ts`
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в `index.ts`
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделей данных)_

- `card:select` - открытие модального окна предпросмотра товара  
- `preview:add` - добавление товара в корзину из окна предпросмотра  
- `preview:remove` - удаление товара из корзины из окна предпросмотра  
- `basket:open` - открытие модального окна корзины  
- `basket:changed` - обновление содержимого корзины на экране  
- `basket:remove` - удаление товара из корзины по кнопке  
- `order:open` - переход к модальному окну с формой оплаты заказа  
- `order.payment:change` - выбор способа оплаты (наличные/карта)  
- `order.address:change` - изменение поля адреса доставки  
- `order.email:change` - изменение поля email покупателя  
- `order.phone:change` - изменение поля телефона покупателя  
- `order:submit` - подтверждение формы оплаты, переход к форме контактов  
- `contacts:submit` - завершение оформления заказа и отправка данных  
- `order:validation` - отображение ошибок валидации формы (адрес, email, телефон)  
- `success:close` - закрытие окна успешного оформления заказа  